const alink=document.createElement("iframe");alink.id=`dmtiframe`;const origin="https://oss.dmartech.cn/public/NbOg2FFuhOisSZwT_DMT_1018.html";alink.src=`${origin}?origin=${window.location.origin}`;alink.style["top"]="0";alink.style["left"]="0";alink.style["width"]="0px";alink.style["opacity"]="0";alink.style["height"]="0px";alink.style["z-index"]="-1";alink.style["display"]="none";alink.style["position"]="absolute";alink.style["border"]="1px solid red";alink.style["transform"]="translate(-100%, -100%)";document.body.appendChild(alink);if(!window.dmt_js_sdk){window.dmt_js_sdk={};var dmt_js_sdk=window.dmt_js_sdk;dmt_js_sdk.getUuidFromCookie=function(){var strcookie=document.cookie;var arrcookie=strcookie.split("; ");var reg=/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[0-9a-f]{4}-[0-9a-f]{12}$/;for(var i=0;i<arrcookie.length;i++){var arr=arrcookie[i].split("=");if(arr[0]=="virtual_id"&&reg.test(arr[1])){return arr[1]}}return null};dmt_js_sdk.setUuidToCookie=function(uuid){const cookie="virtual_id="+uuid+";path=/;expires=Fri, 31 Dec 9999 23:59:59 GMT";document.cookie=cookie;alink.contentWindow.postMessage(cookie,origin)};dmt_js_sdk.createUuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})};dmt_js_sdk.initUuid=function(){var uuid=dmt_js_sdk.getUuidFromCookie();if(!uuid){uuid=dmt_js_sdk.createUuid()}dmt_js_sdk.setUuidToCookie(uuid);dmt_js_sdk.event_data["properties"]["virtual_id"]=uuid;dmt_js_sdk.user_data["properties"]["virtual_id"]=uuid};dmt_js_sdk.windowLoad=function(){dmt_js_sdk.getPageTag();dmt_js_sdk.getWxTag();dmt_js_sdk.saveData(dmt_js_sdk.user_data);dmt_js_sdk.event_data["event"]="view";dmt_js_sdk.getUrlInfo();dmt_js_sdk.getDateTime();dmt_js_sdk.getNavigator();dmt_js_sdk.saveData(dmt_js_sdk.event_data)};dmt_js_sdk.clickListener=function(){document.addEventListener("click",function(){dmt_js_sdk.getUrlInfo();dmt_js_sdk.getDateTime();dmt_js_sdk.getNavigator();for(let key in event.target.attributes){let element=event.target.attributes[key];if(element&&element.nodeName&&element.nodeName.substr(0,5)==="data-"){let name=element.nodeName.substr(5,element.nodeName.length-5);dmt_js_sdk.event_data["properties"][`${name}`]=element.value}}dmt_js_sdk.event_data["event"]="click";dmt_js_sdk.event_data["properties"]["event_text"]=event.target.innerText;dmt_js_sdk.event_data["properties"]["event_html"]=event.target.innerHTML;dmt_js_sdk.event_data["properties"]["event_node"]=event.target.localName;dmt_js_sdk.saveData(dmt_js_sdk.event_data)})};dmt_js_sdk.saveData=function(data){var JS_LIST=window.localStorage.getItem("dmt_js_sdk")?JSON.parse(window.localStorage.getItem("dmt_js_sdk")):[];JS_LIST.push(data);window.localStorage.setItem("dmt_js_sdk",JSON.stringify(JS_LIST));dmt_js_sdk.updateData()};dmt_js_sdk.updateData=function(){var JS_LIST=JSON.parse(window.localStorage.getItem("dmt_js_sdk"));JS_LIST.forEach(item=>{var xhr=null;try{xhr=new XMLHttpRequest}catch(e){xhr=new ActiveXObject("Microsoft.XMLHTTP")}xhr.open("post","https://gate.dmartech.cn/etl/api/v1/api/import?secret=2b6efe73-3e41-482a-8b9e-7ff0bffe7a84",true);xhr.setRequestHeader("Content-type","application/json;charset=UTF-8");xhr.send(JSON.stringify(item));xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status==200){console.info(xhr.responseText)}else{console.info("error:"+xhr.status)}}}});window.localStorage.removeItem("dmt_js_sdk")};dmt_js_sdk.getBeijingTime=function(){var localTime=new Date;var offset_minute=localTime.getTimezoneOffset();if(offset_minute==-480){return localTime}else{return new Date(localTime.getTime()+offset_minute*60*1e3+8*60*60*1e3)}};dmt_js_sdk.getDateTime=function(){var date=dmt_js_sdk.getBeijingTime();dmt_js_sdk.event_data["properties"]["origin_timestamp"]=date.getTime();dmt_js_sdk.event_data["properties"]["event_id"]=`${date.getFullYear()}${date.getMonth()+1}${date.getDate()}${date.getHours()}${date.getMinutes()}${date.getSeconds()}${date.getMilliseconds()}0000`;dmt_js_sdk.event_data["properties"]["create_time"]=`${date.getFullYear()}-${date.getMonth()+1}-${date.getDate()} ${date.getHours()}:${date.getMinutes()}:${date.getSeconds()}`;dmt_js_sdk.event_data["properties"]["event_date"]=`${date.getFullYear()}-${date.getMonth()+1}-${date.getDate()} ${date.getHours()}:${date.getMinutes()}:${date.getSeconds()}`};dmt_js_sdk.getUrlInfo=function(){dmt_js_sdk.event_data["properties"]["page_url"]=window.location.href;if(window.location.hash){if(window.location.hash.includes("?")){dmt_js_sdk.event_data["properties"]["url_anchor"]=window.location.hash.slice(window.location.hash.indexOf("#")+1,window.location.hash.indexOf("?"));window.location.hash.slice(window.location.hash.indexOf("?")+1).split("&").forEach(item=>{dmt_js_sdk.event_data["properties"][`${item.split("=")[0]}`]=item.split("=")[1]})}else{dmt_js_sdk.event_data["properties"]["url_anchor"]=window.location.hash.slice(window.location.hash.indexOf("#")+1)}}if(window.location.search){window.location.search.slice(window.location.search.indexOf("?")+1).split("&").forEach(item=>{dmt_js_sdk.event_data["properties"][`${item.split("=")[0]}`]=item.split("=")[1]})}};dmt_js_sdk.getPageTag=function(){if(document.getElementsByTagName("meta")&&document.getElementsByTagName("meta")["page_tag"]&&document.getElementsByTagName("meta")["page_tag"].content){dmt_js_sdk.user_data["properties"]["label_ids"]=document.getElementsByTagName("meta")["page_tag"].content}};dmt_js_sdk.getWxTag=function(){let reg=/^openid_.*$/;for(let p in dmt_js_sdk.user_data["properties"]){if(reg.test(p)){delete dmt_js_sdk.user_data["properties"][p]}}let wxid=null;let unionid=null;let openid=null;if(document.getElementsByTagName("meta")&&document.getElementsByTagName("meta")["unionid"]&&document.getElementsByTagName("meta")["unionid"].content){dmt_js_sdk.user_data["properties"]["unionid"]=document.getElementsByTagName("meta")["unionid"].content}if(document.getElementsByTagName("meta")&&document.getElementsByTagName("meta")["wxid"]&&document.getElementsByTagName("meta")["wxid"].content){wxid=document.getElementsByTagName("meta")["wxid"].content}if(document.getElementsByTagName("meta")&&document.getElementsByTagName("meta")["openid"]&&document.getElementsByTagName("meta")["openid"].content){openid=document.getElementsByTagName("meta")["openid"].content}if(wxid&&openid){dmt_js_sdk.user_data["properties"]["openid_"+wxid]=openid}};dmt_js_sdk.getNavigator=function(){dmt_js_sdk.event_data["properties"]["navigator_appName"]=window.navigator.appName?window.navigator.appName:"";dmt_js_sdk.event_data["properties"]["navigator_appVersion"]=window.navigator.appVersion?window.navigator.appVersion:"";dmt_js_sdk.event_data["properties"]["navigator_cookieEnabled"]=window.navigator.cookieEnabled?window.navigator.cookieEnabled:"";dmt_js_sdk.event_data["properties"]["navigator_cpuClass"]=window.navigator.cpuClass?window.navigator.cpuClass:"";dmt_js_sdk.event_data["properties"]["navigator_mimeType"]=window.navigator.mimeType?window.navigator.mimeType:"";dmt_js_sdk.event_data["properties"]["navigator_platform"]=window.navigator.platform?window.navigator.platform:"";dmt_js_sdk.event_data["properties"]["navigator_plugins"]=window.navigator.plugins?window.navigator.plugins:"";dmt_js_sdk.event_data["properties"]["navigator_userLanguage"]=window.navigator.userLanguage?window.navigator.userLanguage:"";dmt_js_sdk.event_data["properties"]["navigator_userAgent"]=window.navigator.userAgent?window.navigator.userAgent:"";dmt_js_sdk.event_data["properties"]["navigator_systemLanguage"]=window.navigator.systemLanguage?window.navigator.systemLanguage:"";dmt_js_sdk.event_data["properties"]["navigator_appCodeName"]=window.navigator.appCodeName?window.navigator.appCodeName:"";dmt_js_sdk.event_data["properties"]["navigator_appMinorVersion"]=window.navigator.appMinorVersion?window.navigator.appMinorVersion:"";dmt_js_sdk.event_data["properties"]["navigator_language"]=window.navigator.language?window.navigator.language:"";dmt_js_sdk.event_data["properties"]["navigator_onLine"]=window.navigator.onLine?window.navigator.onLine:"";dmt_js_sdk.event_data["properties"]["navigator_oscpu"]=window.navigator.oscpu?window.navigator.oscpu:"";dmt_js_sdk.event_data["properties"]["navigator_product"]=window.navigator.product?window.navigator.product:"";dmt_js_sdk.event_data["properties"]["navigator_productSub"]=window.navigator.productSub?window.navigator.productSub:"";dmt_js_sdk.event_data["properties"]["navigator_securityPolicy"]=window.navigator.securityPolicy?window.navigator.securityPolicy:"";dmt_js_sdk.event_data["properties"]["navigator_userProfile"]=window.navigator.userProfile?window.navigator.userProfile:"";dmt_js_sdk.event_data["properties"]["navigator_vender"]=window.navigator.vender?window.navigator.vender:"";dmt_js_sdk.event_data["properties"]["navigator_vendorSub"]=window.navigator.vendorSub?window.navigator.vendorSub:"";dmt_js_sdk.event_data["properties"]["navigator_referrer"]=window.document.referrer?window.document.referrer:""};dmt_js_sdk.init=function(){dmt_js_sdk.event_data={type:"event",properties:{}};dmt_js_sdk.user_data={type:"user",properties:{}};dmt_js_sdk.initUuid();dmt_js_sdk.windowLoad();dmt_js_sdk.clickListener()}}alink.onload=function(){window.dmt_js_sdk.init()};window.addEventListener("message",function(e){if(e.data.uuid){window.dmt_js_sdk.setUuidToCookie(e.data.uuid)}},false);