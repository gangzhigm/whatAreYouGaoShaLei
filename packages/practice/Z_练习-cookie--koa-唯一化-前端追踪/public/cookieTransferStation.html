<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>
        // 生成宿主信息
        let Being_Watched_Window = {origin:null, data:null};
        Being_Watched_Window.origin = window.location.href.split("origin=")[1]; 
        
        // 从cookie获取uuid
        function getUuidFromCookie () {
            var strcookie = document.cookie;//获取cookie字符串
            var arrcookie = strcookie.split("; ");//分割
            //uuid格式
            var reg=/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[0-9a-f]{4}-[0-9a-f]{12}$/
            //遍历匹配
            for ( var i = 0; i < arrcookie.length; i++) {
                var arr = arrcookie[i].split("=");
                //返回符合uuid（版本4）的virtual_id值
                if ( arr[0] == "virtual_id" && reg.test( arr[1]) ){
                    return arr[1];
                }
            }
            return null;
        }

        // 监听宿主，注入cookie
        window.addEventListener('message',e=>{
            Being_Watched_Window.origin = e.origin; 
            Being_Watched_Window.data = e.data; 
            document.cookie = `${Being_Watched_Window.data}; domain=${window.location.host}; samesite=none; Secure`;
        },false)

        
        const uuid = getUuidFromCookie();
        window.parent.postMessage({uuid}, Being_Watched_Window.origin);
    </script>
</body>
</html>